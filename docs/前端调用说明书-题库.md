# 前端调用说明书 - 题库模块

本文档为 Vue3 前端开发者提供题库和题目管理功能的 API 调用指南。

---

## 目录

- [1. 概述](#1-概述)
- [2. 题库 API 接口](#2-题库-api-接口)
- [3. 题目 API 接口](#3-题目-api-接口)
- [4. TypeScript 类型定义](#4-typescript-类型定义)
- [5. API 封装实现](#5-api-封装实现)
- [6. Vue3 组件示例](#6-vue3-组件示例)
- [7. 错误处理](#7-错误处理)

---

## 1. 概述

### 1.1 模块说明

题库模块包含两层结构：
- **题库（Question Bank）**：题目的容器，按主题或岗位分类
- **题目（Question）**：具体的面试题，包含题目内容、参考答案、评分标准等

### 1.2 API 前缀

```
/api/v1/questions
```

### 1.3 认证要求

| 接口 | 认证要求 |
|------|---------|
| 获取题库列表 | ❌ 不需要 |
| 获取题库详情 | ❌ 不需要 |
| 创建题库 | ✅ 需要登录 |
| 更新题库 | ✅ 需要登录 |
| 删除题库 | ✅ 需要登录 |
| 获取题目列表 | ❌ 不需要 |
| 获取题目详情 | ❌ 不需要 |
| 创建题目 | ✅ 需要登录 |
| 批量创建题目 | ✅ 需要登录 |
| 更新题目 | ✅ 需要登录 |
| 删除题目 | ✅ 需要登录 |

### 1.4 题目类型枚举

| 值 | 说明 |
|-----|------|
| `technical` | 技术题 |
| `scenario` | 场景题 |
| `algorithm` | 算法题 |
| `behavioral` | 行为面试题 |

### 1.5 难度等级枚举

| 值 | 说明 |
|-----|------|
| `easy` | 简单 |
| `medium` | 中等 |
| `hard` | 困难 |

---

## 2. 题库 API 接口

### 2.1 获取题库列表

**GET** `/api/v1/questions/banks`

**查询参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | ❌ | 页码，默认 1，最小值 1 |
| page_size | int | ❌ | 每页数量，默认 20，范围 1-100 |
| category | string | ❌ | 分类筛选 |
| status | string | ❌ | 状态筛选（active/inactive/deleted） |

**请求示例：**

```
GET /api/v1/questions/banks?page=1&page_size=10&category=frontend
```

**成功响应：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "name": "前端基础题库",
        "description": "包含 HTML、CSS、JavaScript 基础面试题",
        "category": "frontend",
        "tags": ["HTML", "CSS", "JavaScript"],
        "status": "active",
        "created_by": "admin-user-id",
        "created_at": "2026-02-14T10:00:00Z"
      }
    ],
    "total": 15,
    "page": 1,
    "page_size": 10,
    "total_pages": 2
  }
}
```

---

### 2.2 创建题库

**POST** `/api/v1/questions/banks`

**请求头：**

```
Authorization: Bearer <access_token>
```

**请求体：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | ✅ | 题库名称，最大 100 字符 |
| description | string | ❌ | 题库描述 |
| category | string | ❌ | 分类 |
| tags | string[] | ❌ | 标签列表 |

**请求示例：**

```json
{
  "name": "React 进阶题库",
  "description": "React Hooks、性能优化、状态管理等高级面试题",
  "category": "frontend",
  "tags": ["React", "Hooks", "Redux"]
}
```

**成功响应：**

```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440001",
    "name": "React 进阶题库",
    "description": "React Hooks、性能优化、状态管理等高级面试题",
    "category": "frontend",
    "tags": ["React", "Hooks", "Redux"],
    "status": "active",
    "created_by": "current-user-id",
    "created_at": "2026-02-14T15:00:00Z"
  }
}
```

---

### 2.3 获取题库详情

**GET** `/api/v1/questions/banks/{bank_id}`

**路径参数：**

| 参数 | 类型 | 说明 |
|------|------|------|
| bank_id | string | 题库 UUID |

**成功响应：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "前端基础题库",
    "description": "包含 HTML、CSS、JavaScript 基础面试题",
    "category": "frontend",
    "tags": ["HTML", "CSS", "JavaScript"],
    "status": "active",
    "created_by": "admin-user-id",
    "created_at": "2026-02-14T10:00:00Z"
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题库不存在 |

---

### 2.4 更新题库

**PUT** `/api/v1/questions/banks/{bank_id}`

**请求头：**

```
Authorization: Bearer <access_token>
```

**请求体：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | ❌ | 题库名称 |
| description | string | ❌ | 题库描述 |
| category | string | ❌ | 分类 |
| tags | string[] | ❌ | 标签列表 |
| status | string | ❌ | 状态（active/inactive） |

**请求示例：**

```json
{
  "name": "前端基础题库（2026版）",
  "tags": ["HTML5", "CSS3", "ES6+"]
}
```

**成功响应：**

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "前端基础题库（2026版）",
    "description": "包含 HTML、CSS、JavaScript 基础面试题",
    "category": "frontend",
    "tags": ["HTML5", "CSS3", "ES6+"],
    "status": "active",
    "created_by": "admin-user-id",
    "created_at": "2026-02-14T10:00:00Z"
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题库不存在 |

---

### 2.5 删除题库

**DELETE** `/api/v1/questions/banks/{bank_id}`

**请求头：**

```
Authorization: Bearer <access_token>
```

**成功响应：**

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题库不存在 |

---

## 3. 题目 API 接口

### 3.1 获取题目列表

**GET** `/api/v1/questions`

**查询参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | ❌ | 页码，默认 1 |
| page_size | int | ❌ | 每页数量，默认 20，范围 1-100 |
| bank_id | string | ❌ | 所属题库 ID |
| type | string | ❌ | 题目类型（technical/scenario/algorithm/behavioral） |
| category | string | ❌ | 分类筛选 |
| difficulty | string | ❌ | 难度筛选（easy/medium/hard） |
| status | string | ❌ | 状态筛选（active/inactive/deleted） |

**请求示例：**

```
GET /api/v1/questions?page=1&page_size=10&bank_id=xxx&difficulty=medium
```

**成功响应：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": "660e8400-e29b-41d4-a716-446655440000",
        "bank_id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "请解释 JavaScript 中的闭包",
        "content": "什么是闭包？请用代码示例说明闭包的使用场景和注意事项。",
        "type": "technical",
        "category": "JavaScript",
        "difficulty": "medium",
        "difficulty_score": 6,
        "tags": ["闭包", "作用域", "JavaScript"],
        "usage_count": 45,
        "status": "active",
        "created_at": "2026-02-14T10:30:00Z"
      }
    ],
    "total": 120,
    "page": 1,
    "page_size": 10,
    "total_pages": 12
  }
}
```

---

### 3.2 创建题目

**POST** `/api/v1/questions`

**请求头：**

```
Authorization: Bearer <access_token>
```

**请求体：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| bank_id | string | ✅ | 所属题库 ID |
| title | string | ✅ | 题目标题，最大 200 字符 |
| content | string | ✅ | 题目内容 |
| type | string | ✅ | 题目类型（technical/scenario/algorithm/behavioral） |
| category | string | ❌ | 分类 |
| difficulty | string | ✅ | 难度（easy/medium/hard） |
| difficulty_score | int | ❌ | 难度分数，1-10 |
| tags | string[] | ❌ | 标签列表 |
| reference_answer | string | ❌ | 参考答案 |
| answer_key_points | string[] | ❌ | 答案要点列表 |
| scoring_criteria | object | ❌ | 评分标准 |

**请求示例：**

```json
{
  "bank_id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "请解释 React 中的 useEffect Hook",
  "content": "useEffect 的作用是什么？它的依赖数组有什么作用？如何正确清理副作用？",
  "type": "technical",
  "category": "React",
  "difficulty": "medium",
  "difficulty_score": 5,
  "tags": ["React", "Hooks", "useEffect"],
  "reference_answer": "useEffect 是 React 中用于处理副作用的 Hook...",
  "answer_key_points": [
    "理解副作用的概念",
    "依赖数组的作用",
    "清理函数的使用",
    "与生命周期的对比"
  ],
  "scoring_criteria": {
    "concept_understanding": 30,
    "practical_application": 40,
    "edge_cases": 30
  }
}
```

**成功响应：**

```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": "660e8400-e29b-41d4-a716-446655440001",
    "bank_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "请解释 React 中的 useEffect Hook",
    "content": "useEffect 的作用是什么？它的依赖数组有什么作用？如何正确清理副作用？",
    "type": "technical",
    "category": "React",
    "difficulty": "medium",
    "difficulty_score": 5,
    "tags": ["React", "Hooks", "useEffect"],
    "usage_count": 0,
    "status": "active",
    "created_at": "2026-02-14T15:30:00Z"
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 400 | 所属题库不存在 |
| 422 | 参数验证失败 |

---

### 3.3 批量创建题目

**POST** `/api/v1/questions/batch`

**请求头：**

```
Authorization: Bearer <access_token>
```

**请求体：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| bank_id | string | ✅ | 所属题库 ID |
| questions | QuestionItem[] | ✅ | 题目数组，1-100 条 |

**QuestionItem 字段：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | ✅ | 题目标题，最大 200 字符 |
| content | string | ✅ | 题目内容 |
| type | string | ✅ | 题目类型（technical/scenario/algorithm/behavioral） |
| category | string | ❌ | 分类 |
| difficulty | string | ✅ | 难度（easy/medium/hard） |
| difficulty_score | int | ❌ | 难度分数，1-10 |
| tags | string[] | ❌ | 标签列表 |
| reference_answer | string | ❌ | 参考答案 |
| answer_key_points | string[] | ❌ | 答案要点列表 |
| scoring_criteria | object | ❌ | 评分标准 |

**请求示例：**

```json
{
  "bank_id": "550e8400-e29b-41d4-a716-446655440000",
  "questions": [
    {
      "title": "请解释 JavaScript 中的闭包",
      "content": "什么是闭包？请用代码示例说明闭包的使用场景和注意事项。",
      "type": "technical",
      "category": "JavaScript",
      "difficulty": "medium",
      "difficulty_score": 6,
      "tags": ["闭包", "作用域"]
    },
    {
      "title": "React 中 useEffect 的依赖数组",
      "content": "useEffect 第二个参数为空数组、不传、传具体值分别有什么区别？",
      "type": "technical",
      "category": "React",
      "difficulty": "easy",
      "tags": ["React", "Hooks"]
    }
  ]
}
```

**成功响应：**

```json
{
  "code": 200,
  "message": "成功创建 2 道题目",
  "data": {
    "total": 2,
    "questions": [
      {
        "id": "660e8400-e29b-41d4-a716-446655440010",
        "bank_id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "请解释 JavaScript 中的闭包",
        "content": "什么是闭包？请用代码示例说明闭包的使用场景和注意事项。",
        "type": "technical",
        "category": "JavaScript",
        "difficulty": "medium",
        "difficulty_score": 6,
        "tags": ["闭包", "作用域"],
        "usage_count": 0,
        "status": "active",
        "created_at": "2026-02-15T10:00:00Z"
      },
      {
        "id": "660e8400-e29b-41d4-a716-446655440011",
        "bank_id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "React 中 useEffect 的依赖数组",
        "content": "useEffect 第二个参数为空数组、不传、传具体值分别有什么区别？",
        "type": "technical",
        "category": "React",
        "difficulty": "easy",
        "difficulty_score": null,
        "tags": ["React", "Hooks"],
        "usage_count": 0,
        "status": "active",
        "created_at": "2026-02-15T10:00:00Z"
      }
    ]
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|--------|
| 400 | 所属题库不存在 |
| 422 | 参数验证失败（如 questions 为空或超过 100 条） |

---

### 3.4 获取题目详情

**GET** `/api/v1/questions/{question_id}`

**路径参数：**

| 参数 | 类型 | 说明 |
|------|------|------|
| question_id | string | 题目 UUID |

**成功响应：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": "660e8400-e29b-41d4-a716-446655440000",
    "bank_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "请解释 JavaScript 中的闭包",
    "content": "什么是闭包？请用代码示例说明闭包的使用场景和注意事项。",
    "type": "technical",
    "category": "JavaScript",
    "difficulty": "medium",
    "difficulty_score": 6,
    "tags": ["闭包", "作用域", "JavaScript"],
    "usage_count": 45,
    "status": "active",
    "created_at": "2026-02-14T10:30:00Z",
    "reference_answer": "闭包是指有权访问另一个函数作用域中变量的函数...",
    "answer_key_points": [
      "闭包的定义",
      "词法作用域",
      "内存管理注意事项",
      "常见使用场景"
    ],
    "scoring_criteria": {
      "concept": 30,
      "examples": 40,
      "pitfalls": 30
    }
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题目不存在 |

---

### 3.5 更新题目

**PUT** `/api/v1/questions/{question_id}`

**请求头：**

```
Authorization: Bearer <access_token>
```

**请求体：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | ❌ | 题目标题 |
| content | string | ❌ | 题目内容 |
| type | string | ❌ | 题目类型 |
| category | string | ❌ | 分类 |
| difficulty | string | ❌ | 难度 |
| difficulty_score | int | ❌ | 难度分数 |
| tags | string[] | ❌ | 标签列表 |
| reference_answer | string | ❌ | 参考答案 |
| answer_key_points | string[] | ❌ | 答案要点 |
| scoring_criteria | object | ❌ | 评分标准 |
| status | string | ❌ | 状态 |

**请求示例：**

```json
{
  "title": "请深入解释 JavaScript 中的闭包（更新版）",
  "difficulty_score": 7,
  "answer_key_points": [
    "闭包的定义和原理",
    "词法作用域链",
    "内存泄漏及预防",
    "实际应用场景",
    "与模块化的关系"
  ]
}
```

**成功响应：**

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": "660e8400-e29b-41d4-a716-446655440000",
    "bank_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "请深入解释 JavaScript 中的闭包（更新版）",
    "content": "什么是闭包？请用代码示例说明闭包的使用场景和注意事项。",
    "type": "technical",
    "category": "JavaScript",
    "difficulty": "medium",
    "difficulty_score": 7,
    "tags": ["闭包", "作用域", "JavaScript"],
    "usage_count": 45,
    "status": "active",
    "created_at": "2026-02-14T10:30:00Z"
  }
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题目不存在 |

---

### 3.6 删除题目

**DELETE** `/api/v1/questions/{question_id}`

**请求头：**

```
Authorization: Bearer <access_token>
```

**成功响应：**

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**错误响应：**

| HTTP 状态码 | 错误信息 |
|------------|---------|
| 404 | 题目不存在 |

---

## 4. TypeScript 类型定义

创建 `src/types/question.ts`：

```typescript
// ============ 题库类型 ============

/** 创建题库请求 */
export interface QuestionBankCreate {
  name: string
  description?: string
  category?: string
  tags?: string[]
}

/** 更新题库请求 */
export interface QuestionBankUpdate {
  name?: string
  description?: string
  category?: string
  tags?: string[]
  status?: 'active' | 'inactive'
}

/** 题库响应 */
export interface QuestionBank {
  id: string
  name: string
  description: string | null
  category: string | null
  tags: string[] | null
  status: string
  created_by: string | null
  created_at: string
}

/** 题库列表查询参数 */
export interface QuestionBankListParams {
  page?: number
  page_size?: number
  category?: string
  status?: string
}

// ============ 题目类型 ============

/** 题目类型枚举 */
export type QuestionType = 'technical' | 'scenario' | 'algorithm' | 'behavioral'

/** 难度枚举 */
export type Difficulty = 'easy' | 'medium' | 'hard'

/** 创建题目请求 */
export interface QuestionCreate {
  bank_id: string
  title: string
  content: string
  type: QuestionType
  category?: string
  difficulty: Difficulty
  difficulty_score?: number
  tags?: string[]
  reference_answer?: string
  answer_key_points?: string[]
  scoring_criteria?: Record<string, number>
}

/** 批量创建 - 单道题目（不含 bank_id） */
export interface QuestionBatchCreateItem {
  title: string
  content: string
  type: QuestionType
  category?: string
  difficulty: Difficulty
  difficulty_score?: number
  tags?: string[]
  reference_answer?: string
  answer_key_points?: string[]
  scoring_criteria?: Record<string, number>
}

/** 批量创建题目请求 */
export interface QuestionBatchCreate {
  bank_id: string
  questions: QuestionBatchCreateItem[]
}

/** 批量创建题目响应 */
export interface QuestionBatchCreateResponse {
  total: number
  questions: Question[]
}

/** 更新题目请求 */
export interface QuestionUpdate {
  title?: string
  content?: string
  type?: QuestionType
  category?: string
  difficulty?: Difficulty
  difficulty_score?: number
  tags?: string[]
  reference_answer?: string
  answer_key_points?: string[]
  scoring_criteria?: Record<string, number>
  status?: 'active' | 'inactive'
}

/** 题目列表响应 */
export interface Question {
  id: string
  bank_id: string
  title: string
  content: string
  type: QuestionType
  category: string | null
  difficulty: Difficulty
  difficulty_score: number | null
  tags: string[] | null
  usage_count: number
  status: string
  created_at: string
}

/** 题目详情响应（包含答案） */
export interface QuestionDetail extends Question {
  reference_answer: string | null
  answer_key_points: string[] | null
  scoring_criteria: Record<string, number> | null
}

/** 题目列表查询参数 */
export interface QuestionListParams {
  page?: number
  page_size?: number
  bank_id?: string
  type?: QuestionType
  category?: string
  difficulty?: Difficulty
  status?: string
}

// ============ 通用类型 ============

/** 分页响应 */
export interface PaginatedResponse<T> {
  items: T[]
  total: number
  page: number
  page_size: number
  total_pages: number
}

/** 统一 API 响应格式 */
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
}
```

---

## 5. API 封装实现

创建 `src/api/question.ts`：

```typescript
import request from '@/utils/request'
import type {
  QuestionBankCreate,
  QuestionBankUpdate,
  QuestionBankListParams,
  QuestionBank,
  QuestionCreate,
  QuestionUpdate,
  QuestionListParams,
  Question,
  QuestionDetail,
  PaginatedResponse,
  ApiResponse
} from '@/types/question'

const QUESTION_PREFIX = '/questions'

// ============ 题库 API ============

/** 获取题库列表 */
export function listQuestionBanks(
  params?: QuestionBankListParams
): Promise<ApiResponse<PaginatedResponse<QuestionBank>>> {
  return request.get(`${QUESTION_PREFIX}/banks`, { params })
}

/** 创建题库 */
export function createQuestionBank(
  data: QuestionBankCreate
): Promise<ApiResponse<QuestionBank>> {
  return request.post(`${QUESTION_PREFIX}/banks`, data)
}

/** 获取题库详情 */
export function getQuestionBank(
  bankId: string
): Promise<ApiResponse<QuestionBank>> {
  return request.get(`${QUESTION_PREFIX}/banks/${bankId}`)
}

/** 更新题库 */
export function updateQuestionBank(
  bankId: string,
  data: QuestionBankUpdate
): Promise<ApiResponse<QuestionBank>> {
  return request.put(`${QUESTION_PREFIX}/banks/${bankId}`, data)
}

/** 删除题库 */
export function deleteQuestionBank(
  bankId: string
): Promise<ApiResponse<null>> {
  return request.delete(`${QUESTION_PREFIX}/banks/${bankId}`)
}

// ============ 题目 API ============

/** 获取题目列表 */
export function listQuestions(
  params?: QuestionListParams
): Promise<ApiResponse<PaginatedResponse<Question>>> {
  return request.get(QUESTION_PREFIX, { params })
}

/** 创建题目 */
export function createQuestion(
  data: QuestionCreate
): Promise<ApiResponse<Question>> {
  return request.post(QUESTION_PREFIX, data)
}

/** 批量创建题目 */
export function batchCreateQuestions(
  data: QuestionBatchCreate
): Promise<ApiResponse<QuestionBatchCreateResponse>> {
  return request.post(`${QUESTION_PREFIX}/batch`, data)
}

/** 获取题目详情 */
export function getQuestion(
  questionId: string
): Promise<ApiResponse<QuestionDetail>> {
  return request.get(`${QUESTION_PREFIX}/${questionId}`)
}

/** 更新题目 */
export function updateQuestion(
  questionId: string,
  data: QuestionUpdate
): Promise<ApiResponse<Question>> {
  return request.put(`${QUESTION_PREFIX}/${questionId}`, data)
}

/** 删除题目 */
export function deleteQuestion(
  questionId: string
): Promise<ApiResponse<null>> {
  return request.delete(`${QUESTION_PREFIX}/${questionId}`)
}
```

---

## 6. Vue3 组件示例

### 6.1 题库列表组件

创建 `src/views/question/QuestionBankListView.vue`：

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { listQuestionBanks, deleteQuestionBank } from '@/api/question'
import type { QuestionBank, QuestionBankListParams } from '@/types/question'

const router = useRouter()

const banks = ref<QuestionBank[]>([])
const loading = ref(false)
const total = ref(0)

const queryParams = ref<QuestionBankListParams>({
  page: 1,
  page_size: 12,
  category: undefined
})

async function fetchBanks() {
  loading.value = true
  try {
    const res = await listQuestionBanks(queryParams.value)
    banks.value = res.data.items
    total.value = res.data.total
  } catch (error) {
    console.error('获取题库列表失败:', error)
  } finally {
    loading.value = false
  }
}

function viewBank(id: string) {
  router.push(`/questions/banks/${id}`)
}

function editBank(id: string) {
  router.push(`/questions/banks/${id}/edit`)
}

async function handleDelete(id: string) {
  if (!confirm('删除题库会同时删除其下的所有题目，确定继续吗？')) return
  
  try {
    await deleteQuestionBank(id)
    fetchBanks()
  } catch (error) {
    console.error('删除失败:', error)
  }
}

function handlePageChange(page: number) {
  queryParams.value.page = page
  fetchBanks()
}

onMounted(() => {
  fetchBanks()
})
</script>

<template>
  <div class="bank-list">
    <div class="header">
      <h1>题库管理</h1>
      <router-link to="/questions/banks/create" class="btn-create">
        新建题库
      </router-link>
    </div>

    <div class="filters">
      <select v-model="queryParams.category" @change="fetchBanks">
        <option :value="undefined">全部分类</option>
        <option value="frontend">前端</option>
        <option value="backend">后端</option>
        <option value="algorithm">算法</option>
        <option value="system">系统设计</option>
      </select>
    </div>

    <div v-if="loading" class="loading">加载中...</div>

    <div v-else class="bank-grid">
      <div 
        v-for="bank in banks" 
        :key="bank.id" 
        class="bank-card"
        @click="viewBank(bank.id)"
      >
        <h3>{{ bank.name }}</h3>
        <p class="description">{{ bank.description || '暂无描述' }}</p>
        
        <div class="meta">
          <span v-if="bank.category" class="tag category">{{ bank.category }}</span>
          <span :class="['status', bank.status]">{{ bank.status }}</span>
        </div>

        <div class="tags" v-if="bank.tags?.length">
          <span v-for="tag in bank.tags" :key="tag" class="tag">{{ tag }}</span>
        </div>

        <div class="actions" @click.stop>
          <button @click="editBank(bank.id)">编辑</button>
          <button @click="handleDelete(bank.id)" class="danger">删除</button>
        </div>
      </div>
    </div>

    <div class="pagination" v-if="total > queryParams.page_size!">
      <button 
        :disabled="queryParams.page === 1"
        @click="handlePageChange(queryParams.page! - 1)"
      >
        上一页
      </button>
      <span>{{ queryParams.page }} / {{ Math.ceil(total / queryParams.page_size!) }}</span>
      <button 
        :disabled="queryParams.page! * queryParams.page_size! >= total"
        @click="handlePageChange(queryParams.page! + 1)"
      >
        下一页
      </button>
    </div>
  </div>
</template>

<style scoped>
.bank-list {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.btn-create {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  text-decoration: none;
}

.filters {
  margin-bottom: 20px;
}

.filters select {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
}

.bank-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
}

.bank-card {
  background: white;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.bank-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.bank-card h3 {
  margin: 0 0 10px 0;
}

.description {
  color: #666;
  font-size: 14px;
  margin-bottom: 12px;
}

.meta {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
}

.tag {
  font-size: 12px;
  padding: 2px 8px;
  background: #f0f0f0;
  border-radius: 4px;
}

.tag.category {
  background: #e3f2fd;
  color: #1976d2;
}

.status {
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 4px;
}

.status.active {
  background: #e8f5e9;
  color: #2e7d32;
}

.status.inactive {
  background: #fafafa;
  color: #9e9e9e;
}

.tags {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.actions {
  display: flex;
  gap: 8px;
}

.actions button {
  padding: 6px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.actions button.danger {
  color: #e74c3c;
  border-color: #e74c3c;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-top: 30px;
}

.pagination button {
  padding: 8px 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: white;
  cursor: pointer;
}

.pagination button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}
</style>
```

### 6.2 题目列表组件

创建 `src/views/question/QuestionListView.vue`：

```vue
<script setup lang="ts">
import { ref, onMounted, watch } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { listQuestions, deleteQuestion, listQuestionBanks } from '@/api/question'
import type { Question, QuestionListParams, QuestionBank } from '@/types/question'

const router = useRouter()
const route = useRoute()

const questions = ref<Question[]>([])
const banks = ref<QuestionBank[]>([])
const loading = ref(false)
const total = ref(0)

const queryParams = ref<QuestionListParams>({
  page: 1,
  page_size: 20,
  bank_id: route.query.bank_id as string || undefined,
  type: undefined,
  difficulty: undefined
})

// 难度标签颜色
const difficultyColors: Record<string, string> = {
  easy: '#4caf50',
  medium: '#ff9800',
  hard: '#f44336'
}

// 题型显示名称
const typeNames: Record<string, string> = {
  technical: '技术题',
  scenario: '场景题',
  algorithm: '算法题',
  behavioral: '行为题'
}

async function fetchQuestions() {
  loading.value = true
  try {
    const res = await listQuestions(queryParams.value)
    questions.value = res.data.items
    total.value = res.data.total
  } catch (error) {
    console.error('获取题目列表失败:', error)
  } finally {
    loading.value = false
  }
}

async function fetchBanks() {
  try {
    const res = await listQuestionBanks({ page_size: 100 })
    banks.value = res.data.items
  } catch (error) {
    console.error('获取题库列表失败:', error)
  }
}

function viewQuestion(id: string) {
  router.push(`/questions/${id}`)
}

function editQuestion(id: string) {
  router.push(`/questions/${id}/edit`)
}

async function handleDelete(id: string) {
  if (!confirm('确定要删除这道题目吗？')) return
  
  try {
    await deleteQuestion(id)
    fetchQuestions()
  } catch (error) {
    console.error('删除失败:', error)
  }
}

function handleFilterChange() {
  queryParams.value.page = 1
  fetchQuestions()
}

function handlePageChange(page: number) {
  queryParams.value.page = page
  fetchQuestions()
}

onMounted(() => {
  fetchBanks()
  fetchQuestions()
})
</script>

<template>
  <div class="question-list">
    <div class="header">
      <h1>题目管理</h1>
      <router-link to="/questions/create" class="btn-create">
        新建题目
      </router-link>
    </div>

    <div class="filters">
      <select v-model="queryParams.bank_id" @change="handleFilterChange">
        <option :value="undefined">全部题库</option>
        <option v-for="bank in banks" :key="bank.id" :value="bank.id">
          {{ bank.name }}
        </option>
      </select>

      <select v-model="queryParams.type" @change="handleFilterChange">
        <option :value="undefined">全部类型</option>
        <option value="technical">技术题</option>
        <option value="scenario">场景题</option>
        <option value="algorithm">算法题</option>
        <option value="behavioral">行为题</option>
      </select>

      <select v-model="queryParams.difficulty" @change="handleFilterChange">
        <option :value="undefined">全部难度</option>
        <option value="easy">简单</option>
        <option value="medium">中等</option>
        <option value="hard">困难</option>
      </select>
    </div>

    <div v-if="loading" class="loading">加载中...</div>

    <div v-else class="question-table">
      <table>
        <thead>
          <tr>
            <th>标题</th>
            <th>类型</th>
            <th>难度</th>
            <th>分类</th>
            <th>使用次数</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="q in questions" :key="q.id" @click="viewQuestion(q.id)">
            <td class="title-cell">
              <span class="title">{{ q.title }}</span>
              <div class="tags" v-if="q.tags?.length">
                <span v-for="tag in q.tags.slice(0, 3)" :key="tag" class="tag">
                  {{ tag }}
                </span>
              </div>
            </td>
            <td>
              <span class="type-badge">{{ typeNames[q.type] || q.type }}</span>
            </td>
            <td>
              <span 
                class="difficulty-badge" 
                :style="{ backgroundColor: difficultyColors[q.difficulty] }"
              >
                {{ q.difficulty }}
              </span>
            </td>
            <td>{{ q.category || '-' }}</td>
            <td>{{ q.usage_count }}</td>
            <td class="actions" @click.stop>
              <button @click="editQuestion(q.id)">编辑</button>
              <button @click="handleDelete(q.id)" class="danger">删除</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" v-if="total > queryParams.page_size!">
      <button 
        :disabled="queryParams.page === 1"
        @click="handlePageChange(queryParams.page! - 1)"
      >
        上一页
      </button>
      <span>第 {{ queryParams.page }} 页 / 共 {{ Math.ceil(total / queryParams.page_size!) }} 页</span>
      <button 
        :disabled="queryParams.page! * queryParams.page_size! >= total"
        @click="handlePageChange(queryParams.page! + 1)"
      >
        下一页
      </button>
    </div>
  </div>
</template>

<style scoped>
.question-list {
  padding: 20px;
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.btn-create {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  text-decoration: none;
}

.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

.filters select {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
}

.question-table {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 14px 16px;
  text-align: left;
  border-bottom: 1px solid #eee;
}

th {
  background: #f8f9fa;
  font-weight: 600;
  color: #555;
}

tr:hover {
  background: #f8f9fa;
  cursor: pointer;
}

.title-cell {
  max-width: 400px;
}

.title {
  display: block;
  font-weight: 500;
  margin-bottom: 4px;
}

.tags {
  display: flex;
  gap: 4px;
}

.tag {
  font-size: 11px;
  padding: 1px 6px;
  background: #f0f0f0;
  border-radius: 3px;
  color: #666;
}

.type-badge {
  font-size: 12px;
  padding: 4px 8px;
  background: #e3f2fd;
  color: #1976d2;
  border-radius: 4px;
}

.difficulty-badge {
  font-size: 12px;
  padding: 4px 8px;
  color: white;
  border-radius: 4px;
  text-transform: capitalize;
}

.actions {
  display: flex;
  gap: 8px;
}

.actions button {
  padding: 4px 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: white;
  cursor: pointer;
  font-size: 12px;
}

.actions button.danger {
  color: #e74c3c;
  border-color: #e74c3c;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-top: 30px;
}

.pagination button {
  padding: 8px 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: white;
  cursor: pointer;
}

.pagination button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}
</style>
```

---

## 7. 错误处理

### 7.1 错误码对照表

| HTTP 状态码 | 业务含义 | 前端处理建议 |
|------------|---------|-------------|
| 200 | 请求成功 | 正常处理响应数据 |
| 400 | 请求参数错误（如题库不存在） | 显示错误提示 |
| 401 | 未认证 / Token 过期 | 跳转登录页 |
| 404 | 题库/题目不存在 | 显示 404 或返回列表 |
| 422 | 参数验证失败 | 显示具体验证错误 |

### 7.2 组合式函数封装

创建 `src/composables/useQuestion.ts`：

```typescript
import { ref, reactive } from 'vue'
import {
  listQuestionBanks,
  createQuestionBank,
  getQuestionBank,
  updateQuestionBank,
  deleteQuestionBank,
  listQuestions,
  createQuestion,
  batchCreateQuestions,
  getQuestion,
  updateQuestion,
  deleteQuestion
} from '@/api/question'
import type {
  QuestionBank,
  QuestionBankCreate,
  QuestionBankUpdate,
  QuestionBankListParams,
  Question,
  QuestionDetail,
  QuestionCreate,
  QuestionBatchCreate,
  QuestionBatchCreateResponse,
  QuestionUpdate,
  QuestionListParams
} from '@/types/question'

// 题库列表 Hook
export function useQuestionBankList() {
  const banks = ref<QuestionBank[]>([])
  const total = ref(0)
  const loading = ref(false)
  const error = ref<string | null>(null)

  const params = reactive<QuestionBankListParams>({
    page: 1,
    page_size: 20
  })

  async function fetch() {
    loading.value = true
    error.value = null
    try {
      const res = await listQuestionBanks(params)
      banks.value = res.data.items
      total.value = res.data.total
    } catch (e: any) {
      error.value = e.response?.data?.message || '获取失败'
    } finally {
      loading.value = false
    }
  }

  async function remove(id: string): Promise<boolean> {
    try {
      await deleteQuestionBank(id)
      await fetch()
      return true
    } catch {
      return false
    }
  }

  return { banks, total, loading, error, params, fetch, remove }
}

// 题目列表 Hook
export function useQuestionList() {
  const questions = ref<Question[]>([])
  const total = ref(0)
  const loading = ref(false)
  const error = ref<string | null>(null)

  const params = reactive<QuestionListParams>({
    page: 1,
    page_size: 20
  })

  async function fetch() {
    loading.value = true
    error.value = null
    try {
      const res = await listQuestions(params)
      questions.value = res.data.items
      total.value = res.data.total
    } catch (e: any) {
      error.value = e.response?.data?.message || '获取失败'
    } finally {
      loading.value = false
    }
  }

  async function remove(id: string): Promise<boolean> {
    try {
      await deleteQuestion(id)
      await fetch()
      return true
    } catch {
      return false
    }
  }

  return { questions, total, loading, error, params, fetch, remove }
}

// 题目详情 Hook
export function useQuestionDetail() {
  const question = ref<QuestionDetail | null>(null)
  const loading = ref(false)
  const error = ref<string | null>(null)

  async function fetch(id: string) {
    loading.value = true
    error.value = null
    try {
      const res = await getQuestion(id)
      question.value = res.data
    } catch (e: any) {
      error.value = e.response?.data?.message || '获取失败'
    } finally {
      loading.value = false
    }
  }

  async function save(data: QuestionCreate | QuestionUpdate, id?: string): Promise<boolean> {
    loading.value = true
    try {
      if (id) {
        await updateQuestion(id, data as QuestionUpdate)
      } else {
        await createQuestion(data as QuestionCreate)
      }
      return true
    } catch {
      return false
    } finally {
      loading.value = false
    }
  }

  return { question, loading, error, fetch, save }
}

// 批量创建题目 Hook
export function useBatchCreateQuestions() {
  const loading = ref(false)
  const error = ref<string | null>(null)
  const result = ref<QuestionBatchCreateResponse | null>(null)

  async function batchCreate(data: QuestionBatchCreate): Promise<boolean> {
    loading.value = true
    error.value = null
    try {
      const res = await batchCreateQuestions(data)
      result.value = res.data
      return true
    } catch (e: any) {
      error.value = e.response?.data?.message || '批量创建失败'
      return false
    } finally {
      loading.value = false
    }
  }

  return { loading, error, result, batchCreate }
}
```

---

**文档版本**: 1.1  
**最后更新**: 2026-02-15  
**后端 API 版本**: v1
