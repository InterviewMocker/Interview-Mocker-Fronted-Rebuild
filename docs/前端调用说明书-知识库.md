# å‰ç«¯è°ƒç”¨è¯´æ˜ä¹¦ - çŸ¥è¯†åº“æ¨¡å—

æœ¬æ–‡æ¡£ä¸º Vue3 å‰ç«¯å¼€å‘è€…æä¾›çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½çš„ API è°ƒç”¨æŒ‡å—ã€‚

---

## ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. API æ¥å£è¯´æ˜](#2-api-æ¥å£è¯´æ˜)
- [3. TypeScript ç±»å‹å®šä¹‰](#3-typescript-ç±»å‹å®šä¹‰)
- [4. API å°è£…å®ç°](#4-api-å°è£…å®ç°)
- [5. Vue3 ç»„ä»¶ç¤ºä¾‹](#5-vue3-ç»„ä»¶ç¤ºä¾‹)
- [6. é”™è¯¯å¤„ç†](#6-é”™è¯¯å¤„ç†)

---

## 1. æ¦‚è¿°

### 1.1 æ¨¡å—è¯´æ˜

çŸ¥è¯†åº“æ¨¡å—ç”¨äºç®¡ç†é¢è¯•ç›¸å…³çš„çŸ¥è¯†æ–‡æ¡£ï¼ŒåŒ…æ‹¬æŠ€æœ¯æ–‡æ¡£ã€é¢è¯•é¢˜è§£æã€è¡Œä¸šçŸ¥è¯†ç­‰ã€‚æ”¯æŒæ–‡æ¡£çš„å¢åˆ æ”¹æŸ¥ã€åˆ†ç±»ç­›é€‰ã€ä»¥åŠæœªæ¥çš„è¯­ä¹‰æ£€ç´¢åŠŸèƒ½ã€‚

### 1.2 API å‰ç¼€

```
/api/v1/knowledge
```

### 1.3 è®¤è¯è¦æ±‚

| æ¥å£ | è®¤è¯è¦æ±‚ |
|------|---------|
| è·å–æ–‡æ¡£åˆ—è¡¨ | âŒ ä¸éœ€è¦ |
| è·å–æ–‡æ¡£è¯¦æƒ… | âŒ ä¸éœ€è¦ |
| åˆ›å»ºæ–‡æ¡£ | âœ… éœ€è¦ç™»å½• |
| æ›´æ–°æ–‡æ¡£ | âœ… éœ€è¦ç™»å½• |
| åˆ é™¤æ–‡æ¡£ | âœ… éœ€è¦ç™»å½• |
| çŸ¥è¯†åº“æ£€ç´¢ | âŒ ä¸éœ€è¦ï¼ˆå¼€å‘ä¸­ï¼‰ |

---

## 2. API æ¥å£è¯´æ˜

### 2.1 è·å–çŸ¥è¯†æ–‡æ¡£åˆ—è¡¨

**GET** `/api/v1/knowledge/documents`

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | âŒ | é¡µç ï¼Œé»˜è®¤ 1ï¼Œæœ€å°å€¼ 1 |
| page_size | int | âŒ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20ï¼ŒèŒƒå›´ 1-100 |
| category | string | âŒ | åˆ†ç±»ç­›é€‰ |
| doc_type | string | âŒ | æ–‡æ¡£ç±»å‹ç­›é€‰ |
| status | string | âŒ | çŠ¶æ€ç­›é€‰ï¼ˆactive/inactive/deletedï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```
GET /api/v1/knowledge/documents?page=1&page_size=10&category=frontend
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "React Hooks é¢è¯•å¿…å¤‡çŸ¥è¯†ç‚¹",
        "summary": "è¯¦ç»†è®²è§£ React Hooks çš„ä½¿ç”¨å’ŒåŸç†",
        "doc_type": "æŠ€æœ¯æ–‡æ¡£",
        "category": "frontend",
        "tags": ["React", "Hooks", "é¢è¯•"],
        "related_positions": ["frontend-dev", "fullstack-dev"],
        "difficulty": "medium",
        "vectorized": false,
        "chunk_count": 0,
        "view_count": 156,
        "reference_count": 23,
        "status": "active",
        "created_by": "admin-user-id",
        "created_at": "2026-02-14T10:30:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "page_size": 10,
    "total_pages": 5
  }
}
```

---

### 2.2 åˆ›å»ºçŸ¥è¯†æ–‡æ¡£

**POST** `/api/v1/knowledge/documents`

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <access_token>
```

**è¯·æ±‚ä½“ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| title | string | âœ… | æ–‡æ¡£æ ‡é¢˜ï¼Œæœ€å¤§ 200 å­—ç¬¦ |
| content | string | âœ… | æ–‡æ¡£å†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰ |
| summary | string | âŒ | æ–‡æ¡£æ‘˜è¦ |
| doc_type | string | âŒ | æ–‡æ¡£ç±»å‹ |
| category | string | âŒ | åˆ†ç±» |
| tags | string[] | âŒ | æ ‡ç­¾åˆ—è¡¨ |
| related_positions | string[] | âŒ | å…³è”å²—ä½ ID åˆ—è¡¨ |
| difficulty | string | âŒ | éš¾åº¦ï¼ˆeasy/medium/hardï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "title": "JavaScript åŸå‹é“¾è¯¦è§£",
  "content": "# åŸå‹é“¾\n\n## åŸºç¡€æ¦‚å¿µ\n...",
  "summary": "æ·±å…¥ç†è§£ JavaScript åŸå‹é“¾æœºåˆ¶",
  "doc_type": "æŠ€æœ¯æ–‡æ¡£",
  "category": "frontend",
  "tags": ["JavaScript", "åŸå‹é“¾", "é¢è¯•"],
  "related_positions": ["frontend-dev"],
  "difficulty": "medium"
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440001",
    "title": "JavaScript åŸå‹é“¾è¯¦è§£",
    "summary": "æ·±å…¥ç†è§£ JavaScript åŸå‹é“¾æœºåˆ¶",
    "doc_type": "æŠ€æœ¯æ–‡æ¡£",
    "category": "frontend",
    "tags": ["JavaScript", "åŸå‹é“¾", "é¢è¯•"],
    "related_positions": ["frontend-dev"],
    "difficulty": "medium",
    "vectorized": false,
    "chunk_count": 0,
    "view_count": 0,
    "reference_count": 0,
    "status": "active",
    "created_by": "current-user-id",
    "created_at": "2026-02-14T15:00:00Z"
  }
}
```

---

### 2.3 è·å–æ–‡æ¡£è¯¦æƒ…

**GET** `/api/v1/knowledge/documents/{document_id}`

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| document_id | string | æ–‡æ¡£ UUID |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "React Hooks é¢è¯•å¿…å¤‡çŸ¥è¯†ç‚¹",
    "content": "# React Hooks\n\n## useState\n...",
    "summary": "è¯¦ç»†è®²è§£ React Hooks çš„ä½¿ç”¨å’ŒåŸç†",
    "doc_type": "æŠ€æœ¯æ–‡æ¡£",
    "category": "frontend",
    "tags": ["React", "Hooks", "é¢è¯•"],
    "related_positions": ["frontend-dev"],
    "difficulty": "medium",
    "vectorized": false,
    "chunk_count": 0,
    "view_count": 157,
    "reference_count": 23,
    "status": "active",
    "created_by": "admin-user-id",
    "created_at": "2026-02-14T10:30:00Z"
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| HTTP çŠ¶æ€ç  | é”™è¯¯ä¿¡æ¯ |
|------------|---------|
| 404 | æ–‡æ¡£ä¸å­˜åœ¨ |

---

### 2.4 æ›´æ–°çŸ¥è¯†æ–‡æ¡£

**PUT** `/api/v1/knowledge/documents/{document_id}`

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <access_token>
```

**è¯·æ±‚ä½“ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| title | string | âŒ | æ–‡æ¡£æ ‡é¢˜ |
| content | string | âŒ | æ–‡æ¡£å†…å®¹ |
| summary | string | âŒ | æ–‡æ¡£æ‘˜è¦ |
| doc_type | string | âŒ | æ–‡æ¡£ç±»å‹ |
| category | string | âŒ | åˆ†ç±» |
| tags | string[] | âŒ | æ ‡ç­¾åˆ—è¡¨ |
| related_positions | string[] | âŒ | å…³è”å²—ä½ ID åˆ—è¡¨ |
| difficulty | string | âŒ | éš¾åº¦ |
| status | string | âŒ | çŠ¶æ€ï¼ˆactive/inactiveï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "title": "JavaScript åŸå‹é“¾è¯¦è§£ï¼ˆæ›´æ–°ç‰ˆï¼‰",
  "tags": ["JavaScript", "åŸå‹é“¾", "é¢è¯•", "è¿›é˜¶"]
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440001",
    "title": "JavaScript åŸå‹é“¾è¯¦è§£ï¼ˆæ›´æ–°ç‰ˆï¼‰",
    "summary": "æ·±å…¥ç†è§£ JavaScript åŸå‹é“¾æœºåˆ¶",
    "doc_type": "æŠ€æœ¯æ–‡æ¡£",
    "category": "frontend",
    "tags": ["JavaScript", "åŸå‹é“¾", "é¢è¯•", "è¿›é˜¶"],
    "related_positions": ["frontend-dev"],
    "difficulty": "medium",
    "vectorized": false,
    "chunk_count": 0,
    "view_count": 0,
    "reference_count": 0,
    "status": "active",
    "created_by": "current-user-id",
    "created_at": "2026-02-14T15:00:00Z"
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| HTTP çŠ¶æ€ç  | é”™è¯¯ä¿¡æ¯ |
|------------|---------|
| 404 | æ–‡æ¡£ä¸å­˜åœ¨ |

---

### 2.5 åˆ é™¤çŸ¥è¯†æ–‡æ¡£

**DELETE** `/api/v1/knowledge/documents/{document_id}`

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null
}
```

**é”™è¯¯å“åº”ï¼š**

| HTTP çŠ¶æ€ç  | é”™è¯¯ä¿¡æ¯ |
|------------|---------|
| 404 | æ–‡æ¡£ä¸å­˜åœ¨ |

---

### 2.6 çŸ¥è¯†åº“è¯­ä¹‰æ£€ç´¢ï¼ˆå¼€å‘ä¸­ï¼‰

**POST** `/api/v1/knowledge/search`

> âš ï¸ æ­¤æ¥å£æ­£åœ¨å¼€å‘ä¸­ï¼Œæš‚ä¸å¯ç”¨

**è¯·æ±‚ä½“ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| query | string | âœ… | æ£€ç´¢å…³é”®è¯æˆ–é—®é¢˜ |
| position_id | string | âŒ | é™å®šå²—ä½èŒƒå›´ |
| category | string | âŒ | é™å®šåˆ†ç±»èŒƒå›´ |
| top_k | int | âŒ | è¿”å›ç»“æœæ•°é‡ï¼Œé»˜è®¤ 5 |

---

## 3. TypeScript ç±»å‹å®šä¹‰

åˆ›å»º `src/types/knowledge.ts`ï¼š

```typescript
// ============ è¯·æ±‚ç±»å‹ ============

/** åˆ›å»ºçŸ¥è¯†æ–‡æ¡£è¯·æ±‚ */
export interface KnowledgeDocumentCreate {
  title: string
  content: string
  summary?: string
  doc_type?: string
  category?: string
  tags?: string[]
  related_positions?: string[]
  difficulty?: 'easy' | 'medium' | 'hard'
}

/** æ›´æ–°çŸ¥è¯†æ–‡æ¡£è¯·æ±‚ */
export interface KnowledgeDocumentUpdate {
  title?: string
  content?: string
  summary?: string
  doc_type?: string
  category?: string
  tags?: string[]
  related_positions?: string[]
  difficulty?: 'easy' | 'medium' | 'hard'
  status?: 'active' | 'inactive'
}

/** çŸ¥è¯†æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢å‚æ•° */
export interface KnowledgeDocumentListParams {
  page?: number
  page_size?: number
  category?: string
  doc_type?: string
  status?: string
}

// ============ å“åº”ç±»å‹ ============

/** çŸ¥è¯†æ–‡æ¡£å“åº” */
export interface KnowledgeDocument {
  id: string
  title: string
  summary: string | null
  doc_type: string | null
  category: string | null
  tags: string[] | null
  related_positions: string[] | null
  difficulty: string | null
  vectorized: boolean
  chunk_count: number
  view_count: number
  reference_count: number
  status: string
  created_by: string | null
  created_at: string
}

/** çŸ¥è¯†æ–‡æ¡£è¯¦æƒ…å“åº”ï¼ˆåŒ…å«å†…å®¹ï¼‰ */
export interface KnowledgeDocumentDetail extends KnowledgeDocument {
  content: string
}

/** åˆ†é¡µå“åº” */
export interface PaginatedResponse<T> {
  items: T[]
  total: number
  page: number
  page_size: number
  total_pages: number
}

/** ç»Ÿä¸€ API å“åº”æ ¼å¼ */
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
}
```

---

## 4. API å°è£…å®ç°

åˆ›å»º `src/api/knowledge.ts`ï¼š

```typescript
import request from '@/utils/request'
import type {
  KnowledgeDocumentCreate,
  KnowledgeDocumentUpdate,
  KnowledgeDocumentListParams,
  KnowledgeDocument,
  KnowledgeDocumentDetail,
  PaginatedResponse,
  ApiResponse
} from '@/types/knowledge'

const KNOWLEDGE_PREFIX = '/knowledge'

/** è·å–çŸ¥è¯†æ–‡æ¡£åˆ—è¡¨ */
export function listKnowledgeDocuments(
  params?: KnowledgeDocumentListParams
): Promise<ApiResponse<PaginatedResponse<KnowledgeDocument>>> {
  return request.get(`${KNOWLEDGE_PREFIX}/documents`, { params })
}

/** åˆ›å»ºçŸ¥è¯†æ–‡æ¡£ */
export function createKnowledgeDocument(
  data: KnowledgeDocumentCreate
): Promise<ApiResponse<KnowledgeDocument>> {
  return request.post(`${KNOWLEDGE_PREFIX}/documents`, data)
}

/** è·å–çŸ¥è¯†æ–‡æ¡£è¯¦æƒ… */
export function getKnowledgeDocument(
  documentId: string
): Promise<ApiResponse<KnowledgeDocumentDetail>> {
  return request.get(`${KNOWLEDGE_PREFIX}/documents/${documentId}`)
}

/** æ›´æ–°çŸ¥è¯†æ–‡æ¡£ */
export function updateKnowledgeDocument(
  documentId: string,
  data: KnowledgeDocumentUpdate
): Promise<ApiResponse<KnowledgeDocument>> {
  return request.put(`${KNOWLEDGE_PREFIX}/documents/${documentId}`, data)
}

/** åˆ é™¤çŸ¥è¯†æ–‡æ¡£ */
export function deleteKnowledgeDocument(
  documentId: string
): Promise<ApiResponse<null>> {
  return request.delete(`${KNOWLEDGE_PREFIX}/documents/${documentId}`)
}
```

---

## 5. Vue3 ç»„ä»¶ç¤ºä¾‹

### 5.1 çŸ¥è¯†æ–‡æ¡£åˆ—è¡¨ç»„ä»¶

åˆ›å»º `src/views/knowledge/KnowledgeListView.vue`ï¼š

```vue
<script setup lang="ts">
import { ref, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import { listKnowledgeDocuments, deleteKnowledgeDocument } from '@/api/knowledge'
import type { KnowledgeDocument, KnowledgeDocumentListParams } from '@/types/knowledge'

const router = useRouter()

// åˆ—è¡¨æ•°æ®
const documents = ref<KnowledgeDocument[]>([])
const loading = ref(false)
const total = ref(0)

// æŸ¥è¯¢å‚æ•°
const queryParams = ref<KnowledgeDocumentListParams>({
  page: 1,
  page_size: 10,
  category: undefined,
  doc_type: undefined
})

// è·å–æ–‡æ¡£åˆ—è¡¨
async function fetchDocuments() {
  loading.value = true
  try {
    const res = await listKnowledgeDocuments(queryParams.value)
    documents.value = res.data.items
    total.value = res.data.total
  } catch (error) {
    console.error('è·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// æŸ¥çœ‹è¯¦æƒ…
function viewDocument(id: string) {
  router.push(`/knowledge/${id}`)
}

// ç¼–è¾‘æ–‡æ¡£
function editDocument(id: string) {
  router.push(`/knowledge/${id}/edit`)
}

// åˆ é™¤æ–‡æ¡£
async function handleDelete(id: string) {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡æ¡£å—ï¼Ÿ')) return
  
  try {
    await deleteKnowledgeDocument(id)
    // åˆ·æ–°åˆ—è¡¨
    fetchDocuments()
  } catch (error) {
    console.error('åˆ é™¤å¤±è´¥:', error)
  }
}

// åˆ†é¡µå˜åŒ–
function handlePageChange(page: number) {
  queryParams.value.page = page
  fetchDocuments()
}

// ç­›é€‰å˜åŒ–
function handleFilterChange() {
  queryParams.value.page = 1
  fetchDocuments()
}

onMounted(() => {
  fetchDocuments()
})
</script>

<template>
  <div class="knowledge-list">
    <div class="header">
      <h1>çŸ¥è¯†åº“</h1>
      <router-link to="/knowledge/create" class="btn-create">
        æ–°å»ºæ–‡æ¡£
      </router-link>
    </div>

    <!-- ç­›é€‰æ  -->
    <div class="filters">
      <select v-model="queryParams.category" @change="handleFilterChange">
        <option :value="undefined">å…¨éƒ¨åˆ†ç±»</option>
        <option value="frontend">å‰ç«¯</option>
        <option value="backend">åç«¯</option>
        <option value="algorithm">ç®—æ³•</option>
        <option value="database">æ•°æ®åº“</option>
      </select>

      <select v-model="queryParams.doc_type" @change="handleFilterChange">
        <option :value="undefined">å…¨éƒ¨ç±»å‹</option>
        <option value="æŠ€æœ¯æ–‡æ¡£">æŠ€æœ¯æ–‡æ¡£</option>
        <option value="é¢è¯•é¢˜è§£">é¢è¯•é¢˜è§£</option>
        <option value="çŸ¥è¯†æ€»ç»“">çŸ¥è¯†æ€»ç»“</option>
      </select>
    </div>

    <!-- æ–‡æ¡£åˆ—è¡¨ -->
    <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
    
    <div v-else class="document-grid">
      <div 
        v-for="doc in documents" 
        :key="doc.id" 
        class="document-card"
        @click="viewDocument(doc.id)"
      >
        <h3>{{ doc.title }}</h3>
        <p class="summary">{{ doc.summary || 'æš‚æ— æ‘˜è¦' }}</p>
        
        <div class="meta">
          <span v-if="doc.category" class="tag category">{{ doc.category }}</span>
          <span v-if="doc.difficulty" class="tag difficulty">{{ doc.difficulty }}</span>
          <span class="view-count">ğŸ‘ {{ doc.view_count }}</span>
        </div>
        
        <div class="tags" v-if="doc.tags?.length">
          <span v-for="tag in doc.tags" :key="tag" class="tag">{{ tag }}</span>
        </div>

        <div class="actions" @click.stop>
          <button @click="editDocument(doc.id)">ç¼–è¾‘</button>
          <button @click="handleDelete(doc.id)" class="danger">åˆ é™¤</button>
        </div>
      </div>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="total > queryParams.page_size!">
      <button 
        :disabled="queryParams.page === 1"
        @click="handlePageChange(queryParams.page! - 1)"
      >
        ä¸Šä¸€é¡µ
      </button>
      <span>ç¬¬ {{ queryParams.page }} é¡µ / å…± {{ Math.ceil(total / queryParams.page_size!) }} é¡µ</span>
      <button 
        :disabled="queryParams.page! * queryParams.page_size! >= total"
        @click="handlePageChange(queryParams.page! + 1)"
      >
        ä¸‹ä¸€é¡µ
      </button>
    </div>
  </div>
</template>

<style scoped>
.knowledge-list {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.btn-create {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  text-decoration: none;
}

.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

.filters select {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
}

.document-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}

.document-card {
  background: white;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: box-shadow 0.3s;
}

.document-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.document-card h3 {
  margin: 0 0 10px 0;
  font-size: 18px;
}

.summary {
  color: #666;
  font-size: 14px;
  margin-bottom: 12px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.meta {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.tag {
  font-size: 12px;
  padding: 2px 8px;
  background: #f0f0f0;
  border-radius: 4px;
}

.tag.category {
  background: #e3f2fd;
  color: #1976d2;
}

.tag.difficulty {
  background: #fff3e0;
  color: #f57c00;
}

.tags {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.actions {
  display: flex;
  gap: 8px;
}

.actions button {
  padding: 6px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.actions button.danger {
  color: #e74c3c;
  border-color: #e74c3c;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-top: 30px;
}

.pagination button {
  padding: 8px 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: white;
  cursor: pointer;
}

.pagination button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}
</style>
```

### 5.2 åˆ›å»º/ç¼–è¾‘æ–‡æ¡£ç»„ä»¶

åˆ›å»º `src/views/knowledge/KnowledgeEditView.vue`ï¼š

```vue
<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { 
  createKnowledgeDocument, 
  getKnowledgeDocument, 
  updateKnowledgeDocument 
} from '@/api/knowledge'
import type { KnowledgeDocumentCreate, KnowledgeDocumentUpdate } from '@/types/knowledge'

const router = useRouter()
const route = useRoute()

const isEdit = computed(() => !!route.params.id)
const documentId = computed(() => route.params.id as string)

const loading = ref(false)
const saving = ref(false)

const form = ref<KnowledgeDocumentCreate>({
  title: '',
  content: '',
  summary: '',
  doc_type: '',
  category: '',
  tags: [],
  related_positions: [],
  difficulty: undefined
})

const tagInput = ref('')

// åŠ è½½æ–‡æ¡£æ•°æ®ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
async function loadDocument() {
  if (!isEdit.value) return
  
  loading.value = true
  try {
    const res = await getKnowledgeDocument(documentId.value)
    const doc = res.data
    form.value = {
      title: doc.title,
      content: doc.content,
      summary: doc.summary || '',
      doc_type: doc.doc_type || '',
      category: doc.category || '',
      tags: doc.tags || [],
      related_positions: doc.related_positions || [],
      difficulty: doc.difficulty as any
    }
  } catch (error) {
    console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', error)
    router.push('/knowledge')
  } finally {
    loading.value = false
  }
}

// æ·»åŠ æ ‡ç­¾
function addTag() {
  const tag = tagInput.value.trim()
  if (tag && !form.value.tags?.includes(tag)) {
    form.value.tags = [...(form.value.tags || []), tag]
    tagInput.value = ''
  }
}

// ç§»é™¤æ ‡ç­¾
function removeTag(tag: string) {
  form.value.tags = form.value.tags?.filter(t => t !== tag)
}

// æäº¤è¡¨å•
async function handleSubmit() {
  if (!form.value.title || !form.value.content) {
    alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹')
    return
  }

  saving.value = true
  try {
    if (isEdit.value) {
      await updateKnowledgeDocument(documentId.value, form.value as KnowledgeDocumentUpdate)
    } else {
      await createKnowledgeDocument(form.value)
    }
    router.push('/knowledge')
  } catch (error) {
    console.error('ä¿å­˜å¤±è´¥:', error)
  } finally {
    saving.value = false
  }
}

onMounted(() => {
  loadDocument()
})
</script>

<template>
  <div class="knowledge-edit">
    <h1>{{ isEdit ? 'ç¼–è¾‘æ–‡æ¡£' : 'æ–°å»ºæ–‡æ¡£' }}</h1>

    <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>

    <form v-else @submit.prevent="handleSubmit" class="edit-form">
      <div class="form-group">
        <label for="title">æ ‡é¢˜ *</label>
        <input
          id="title"
          v-model="form.title"
          type="text"
          placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜"
          maxlength="200"
          required
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="category">åˆ†ç±»</label>
          <select id="category" v-model="form.category">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="frontend">å‰ç«¯</option>
            <option value="backend">åç«¯</option>
            <option value="algorithm">ç®—æ³•</option>
            <option value="database">æ•°æ®åº“</option>
            <option value="system">ç³»ç»Ÿè®¾è®¡</option>
          </select>
        </div>

        <div class="form-group">
          <label for="doc_type">æ–‡æ¡£ç±»å‹</label>
          <select id="doc_type" v-model="form.doc_type">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="æŠ€æœ¯æ–‡æ¡£">æŠ€æœ¯æ–‡æ¡£</option>
            <option value="é¢è¯•é¢˜è§£">é¢è¯•é¢˜è§£</option>
            <option value="çŸ¥è¯†æ€»ç»“">çŸ¥è¯†æ€»ç»“</option>
            <option value="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</option>
          </select>
        </div>

        <div class="form-group">
          <label for="difficulty">éš¾åº¦</label>
          <select id="difficulty" v-model="form.difficulty">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="easy">ç®€å•</option>
            <option value="medium">ä¸­ç­‰</option>
            <option value="hard">å›°éš¾</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="summary">æ‘˜è¦</label>
        <textarea
          id="summary"
          v-model="form.summary"
          placeholder="è¯·è¾“å…¥æ–‡æ¡£æ‘˜è¦"
          rows="2"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="content">å†…å®¹ * (æ”¯æŒ Markdown)</label>
        <textarea
          id="content"
          v-model="form.content"
          placeholder="è¯·è¾“å…¥æ–‡æ¡£å†…å®¹ï¼Œæ”¯æŒ Markdown æ ¼å¼"
          rows="15"
          required
        ></textarea>
      </div>

      <div class="form-group">
        <label>æ ‡ç­¾</label>
        <div class="tag-input">
          <input
            v-model="tagInput"
            type="text"
            placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦"
            @keydown.enter.prevent="addTag"
          />
          <button type="button" @click="addTag">æ·»åŠ </button>
        </div>
        <div class="tags" v-if="form.tags?.length">
          <span v-for="tag in form.tags" :key="tag" class="tag">
            {{ tag }}
            <button type="button" @click="removeTag(tag)">Ã—</button>
          </span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" @click="router.back()" class="btn-cancel">
          å–æ¶ˆ
        </button>
        <button type="submit" :disabled="saving" class="btn-submit">
          {{ saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
        </button>
      </div>
    </form>
  </div>
</template>

<style scoped>
.knowledge-edit {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

.edit-form {
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 14px;
}

.form-group textarea {
  resize: vertical;
  font-family: monospace;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}

.tag-input {
  display: flex;
  gap: 8px;
}

.tag-input input {
  flex: 1;
}

.tag-input button {
  padding: 10px 16px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 10px;
}

.tags .tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: #e3f2fd;
  color: #1976d2;
  border-radius: 4px;
  font-size: 14px;
}

.tags .tag button {
  background: none;
  border: none;
  color: #1976d2;
  cursor: pointer;
  padding: 0;
  font-size: 16px;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 30px;
}

.btn-cancel {
  padding: 12px 24px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: white;
  cursor: pointer;
}

.btn-submit {
  padding: 12px 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.btn-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}
</style>
```

---

## 6. é”™è¯¯å¤„ç†

### 6.1 é”™è¯¯ç å¯¹ç…§è¡¨

| HTTP çŠ¶æ€ç  | ä¸šåŠ¡å«ä¹‰ | å‰ç«¯å¤„ç†å»ºè®® |
|------------|---------|-------------|
| 200 | è¯·æ±‚æˆåŠŸ | æ­£å¸¸å¤„ç†å“åº”æ•°æ® |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ˜¾ç¤ºé”™è¯¯æç¤º |
| 401 | æœªè®¤è¯ / Token è¿‡æœŸ | è·³è½¬ç™»å½•é¡µ |
| 404 | æ–‡æ¡£ä¸å­˜åœ¨ | æ˜¾ç¤º 404 æˆ–è¿”å›åˆ—è¡¨ |
| 422 | å‚æ•°éªŒè¯å¤±è´¥ | æ˜¾ç¤ºå…·ä½“éªŒè¯é”™è¯¯ |
| 501 | åŠŸèƒ½æœªå®ç° | æç¤ºåŠŸèƒ½å¼€å‘ä¸­ |

### 6.2 ç»„åˆå¼å‡½æ•°å°è£…

åˆ›å»º `src/composables/useKnowledge.ts`ï¼š

```typescript
import { ref, reactive } from 'vue'
import {
  listKnowledgeDocuments,
  createKnowledgeDocument,
  getKnowledgeDocument,
  updateKnowledgeDocument,
  deleteKnowledgeDocument
} from '@/api/knowledge'
import type {
  KnowledgeDocument,
  KnowledgeDocumentDetail,
  KnowledgeDocumentCreate,
  KnowledgeDocumentUpdate,
  KnowledgeDocumentListParams
} from '@/types/knowledge'

export function useKnowledgeList() {
  const documents = ref<KnowledgeDocument[]>([])
  const total = ref(0)
  const loading = ref(false)
  const error = ref<string | null>(null)

  const params = reactive<KnowledgeDocumentListParams>({
    page: 1,
    page_size: 20
  })

  async function fetch() {
    loading.value = true
    error.value = null
    try {
      const res = await listKnowledgeDocuments(params)
      documents.value = res.data.items
      total.value = res.data.total
    } catch (e: any) {
      error.value = e.response?.data?.message || 'è·å–å¤±è´¥'
    } finally {
      loading.value = false
    }
  }

  async function remove(id: string): Promise<boolean> {
    try {
      await deleteKnowledgeDocument(id)
      await fetch()
      return true
    } catch {
      return false
    }
  }

  return {
    documents,
    total,
    loading,
    error,
    params,
    fetch,
    remove
  }
}

export function useKnowledgeDetail() {
  const document = ref<KnowledgeDocumentDetail | null>(null)
  const loading = ref(false)
  const error = ref<string | null>(null)

  async function fetch(id: string) {
    loading.value = true
    error.value = null
    try {
      const res = await getKnowledgeDocument(id)
      document.value = res.data
    } catch (e: any) {
      error.value = e.response?.data?.message || 'è·å–å¤±è´¥'
    } finally {
      loading.value = false
    }
  }

  async function save(
    data: KnowledgeDocumentCreate | KnowledgeDocumentUpdate,
    id?: string
  ): Promise<boolean> {
    loading.value = true
    try {
      if (id) {
        await updateKnowledgeDocument(id, data as KnowledgeDocumentUpdate)
      } else {
        await createKnowledgeDocument(data as KnowledgeDocumentCreate)
      }
      return true
    } catch {
      return false
    } finally {
      loading.value = false
    }
  }

  return {
    document,
    loading,
    error,
    fetch,
    save
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-02-14  
**åç«¯ API ç‰ˆæœ¬**: v1
